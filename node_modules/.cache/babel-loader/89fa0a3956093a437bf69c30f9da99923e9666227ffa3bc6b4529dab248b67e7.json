{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useParams}from\"react-router-dom\";import{useModal}from\"../../context/ModalContext\";import\"./DogCafeReviewList.css\";import Header from\"../Header\";import Footer from\"../Footer\";import Modal from\"../../components/Modal\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const DogCafeReviewList=()=>{const{storeId}=useParams();const{openModal}=useModal();const[reviews,setReviews]=useState([]);const[error,setError]=useState(null);const[averageRating,setAverageRating]=useState(0);const[storeName,setStoreName]=useState(\"\");useEffect(()=>{if(!storeId)return;const fetchReviews=async()=>{try{const response=await fetch(`${process.env.REACT_APP_BASE_URL}/reviews/${storeId}`);if(!response.ok)throw new Error(\"口コミの取得に失敗しました\");const data=await response.json();setReviews(data);if(data.length>0){const avgRating=data.reduce((sum,review)=>sum+review.rating,0)/data.length;setAverageRating(Math.min(avgRating,5));// 5を超えないように制限\n}}catch(err){console.error(\"エラー詳細:\",err);setError(\"口コミの取得に失敗しました\");}};const fetchStoreName=async()=>{try{const response=await fetch(`${process.env.REACT_APP_BASE_URL}/stores/store-name/${storeId}`);if(!response.ok)throw new Error(\"店舗情報の取得に失敗しました\");const data=await response.json();setStoreName(data.store_name);}catch(err){console.error(\"エラー詳細:\",err);setError(\"店舗情報の取得に失敗しました\");}};fetchReviews();fetchStoreName();},[storeId]);// 口コミを投稿する関数\nconst handleReviewSubmit=async(rating,comment)=>{try{const response=await fetch(`${process.env.REACT_APP_BASE_URL}/reviews/${storeId}`,{method:\"POST\",headers:{\"Content-type\":\"application/json\"},body:JSON.stringify({store_id:storeId,rating,comment})});if(!response.ok){throw new Error(\"コメント投稿に失敗しました\");}const newReview=await response.json();setReviews(prevReviews=>{const updatedReviews=[newReview,...prevReviews];// 新しい口コミを追加\nconst newAverageRating=updatedReviews.reduce((sum,rev)=>sum+rev.rating,0)/updatedReviews.length;setAverageRating(newAverageRating);// 平均評価を更新\nreturn updatedReviews;// 更新されたレビューリストを `setReviews` にセット\n});}catch(err){console.error(\"エラー詳細:\",err);setError(\"コメント投稿に失敗しました\");}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"review-container\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"store-name\",children:storeName||\"店舗名を取得中...\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"star-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"stars-background\",children:\"\\u2605\\u2605\\u2605\\u2605\\u2605\"}),/*#__PURE__*/_jsx(\"div\",{className:\"stars-filled\",style:{width:`${Math.min(averageRating,5)/5*100}%`},children:\"\\u2605\\u2605\\u2605\\u2605\\u2605\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"average-rating-value\",children:averageRating.toFixed(1)}),/*#__PURE__*/_jsx(\"h2\",{className:\"review-title\",children:\"\\u53E3\\u30B3\\u30DF\\u4E00\\u89A7\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>openModal(storeName),className:\"review-button\",children:\"\\u6295\\u7A3F\"}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"error-message\",children:error}),reviews.map(review=>/*#__PURE__*/_jsxs(\"div\",{className:\"review-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"review-rating\",children:[[1,2,3,4,5].map(value=>/*#__PURE__*/_jsx(\"span\",{className:`star ${value<=review.rating?\"selected\":\"\"}`,children:\"\\u2605\"},value)),/*#__PURE__*/_jsx(\"strong\",{style:{marginLeft:\"8px\"},children:review.rating})]}),/*#__PURE__*/_jsx(\"p\",{className:\"review-comment\",children:review.comment})]},review.id))]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(Modal,{onSubmit:handleReviewSubmit})]});};export default DogCafeReviewList;","map":{"version":3,"names":["React","useEffect","useState","useParams","useModal","Header","Footer","Modal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","DogCafeReviewList","storeId","openModal","reviews","setReviews","error","setError","averageRating","setAverageRating","storeName","setStoreName","fetchReviews","response","fetch","process","env","REACT_APP_BASE_URL","ok","Error","data","json","length","avgRating","reduce","sum","review","rating","Math","min","err","console","fetchStoreName","store_name","handleReviewSubmit","comment","method","headers","body","JSON","stringify","store_id","newReview","prevReviews","updatedReviews","newAverageRating","rev","children","className","style","width","toFixed","onClick","map","value","marginLeft","id","onSubmit"],"sources":["/Users/hadamayuka/Desktop/wan_paradise/my-app/src/pages/Dogcafe/DogCafeReviewList.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport { useModal } from \"../../context/ModalContext\";\nimport \"./DogCafeReviewList.css\";\nimport Header from \"../Header\";\nimport Footer from \"../Footer\";\nimport Modal from \"../../components/Modal\";\n\ntype Review = {\n  id: number;\n  store_id: number;\n  rating: number;\n  comment: string;\n  created_at: string;\n};\n\nconst DogCafeReviewList: React.FC = () => {\n  const { storeId } = useParams<{ storeId: string }>();\n  const { openModal } = useModal();\n  const [reviews, setReviews] = useState<Review[]>([]);\n  const [error, setError] = useState<string | null>(null);\n  const [averageRating, setAverageRating] = useState<number>(0);\n  const [storeName, setStoreName] = useState<string>(\"\");\n\n  useEffect(() => {\n    if (!storeId) return;\n\n    const fetchReviews = async () => {\n      try {\n        const response = await fetch(\n          `${process.env.REACT_APP_BASE_URL}/reviews/${storeId}`\n        );\n        if (!response.ok) throw new Error(\"口コミの取得に失敗しました\");\n\n        const data = await response.json();\n        setReviews(data);\n\n        if (data.length > 0) {\n          const avgRating =\n            data.reduce((sum: number, review: Review) => sum + review.rating, 0) /\n            data.length;\n          setAverageRating(Math.min(avgRating, 5)); // 5を超えないように制限\n        }\n      } catch (err) {\n        console.error(\"エラー詳細:\", err);\n        setError(\"口コミの取得に失敗しました\");\n      }\n    };\n\n    const fetchStoreName = async () => {\n      try {\n        const response = await fetch(\n          `${process.env.REACT_APP_BASE_URL}/stores/store-name/${storeId}`\n        );\n        if (!response.ok) throw new Error(\"店舗情報の取得に失敗しました\");\n\n        const data = await response.json();\n        setStoreName(data.store_name);\n      } catch (err) {\n        console.error(\"エラー詳細:\", err);\n        setError(\"店舗情報の取得に失敗しました\");\n      }\n    };\n\n    fetchReviews();\n    fetchStoreName();\n  }, [storeId]);\n\n  // 口コミを投稿する関数\n  const handleReviewSubmit = async (rating: number, comment: string) => {\n    try {\n      const response = await fetch(`${process.env.REACT_APP_BASE_URL}/reviews/${storeId}`, {\n        method: \"POST\",\n        headers: { \"Content-type\": \"application/json\" },\n        body: JSON.stringify({\n          store_id: storeId,\n          rating,\n          comment,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"コメント投稿に失敗しました\");\n      }\n\n      const newReview = await response.json();\n      \n      setReviews((prevReviews) => {\n        const updatedReviews = [newReview, ...prevReviews]; // 新しい口コミを追加\n        const newAverageRating =\n          updatedReviews.reduce((sum: number, rev: Review) => sum + rev.rating, 0) /\n          updatedReviews.length;\n\n        setAverageRating(newAverageRating); // 平均評価を更新\n\n        return updatedReviews; // 更新されたレビューリストを `setReviews` にセット\n      });\n      \n    } catch (err) {\n      console.error(\"エラー詳細:\", err);\n      setError(\"コメント投稿に失敗しました\");\n    }\n  };\n\n  return (\n    <>\n      <Header />\n      <div className=\"review-container\">\n        <h1 className=\"store-name\">{storeName || \"店舗名を取得中...\"}</h1>\n\n        <div className=\"star-container\">\n          <div className=\"stars-background\">★★★★★</div>\n          <div\n            className=\"stars-filled\"\n            style={{ width: `${(Math.min(averageRating, 5) / 5) * 100}%` }}\n          >\n            ★★★★★\n          </div>\n        </div>\n        <span className=\"average-rating-value\">{averageRating.toFixed(1)}</span>\n\n        <h2 className=\"review-title\">口コミ一覧</h2>\n        <button onClick={() => openModal(storeName)} className=\"review-button\">\n          投稿\n        </button>\n\n        {error && <p className=\"error-message\">{error}</p>}\n\n        {reviews.map((review) => (\n          <div key={review.id} className=\"review-card\">\n            <div className=\"review-rating\">\n              {[1, 2, 3, 4, 5].map((value) => (\n                <span\n                  key={value}\n                  className={`star ${value <= review.rating ? \"selected\" : \"\"}`}\n                >\n                  ★\n                </span>\n              ))}\n              <strong style={{ marginLeft: \"8px\" }}>{review.rating}</strong>\n            </div>\n            <p className=\"review-comment\">{review.comment}</p>\n          </div>\n        ))}\n      </div>\n    <Footer/>\n      {/* モーダルを表示、onSubmitを渡す */}\n      <Modal onSubmit={handleReviewSubmit} />\n    </>\n  );\n};\n\nexport default DogCafeReviewList;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}