{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useParams}from\"react-router-dom\";import{useModal}from\"../../context/ModalContext\";import\"./HospitalReviewList.css\";import Modal from\"../../components/Modal\";import Header from\"../Header\";import Footer from\"../Footer\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const HospitalReviewList=()=>{const{storeId}=useParams();const{openModal}=useModal();const[reviews,setReviews]=useState([]);const[error,setError]=useState(null);const[averageRating,setAverageRating]=useState(0);const[storeName,setStoreName]=useState(\"\");useEffect(()=>{if(!storeId)return;const fetchReviews=async()=>{try{const response=await fetch(`${process.env.REACT_APP_BASE_URL}/reviews/${storeId}`);if(!response.ok)throw new Error(\"口コミの取得に失敗しました\");const data=await response.json();setReviews(data);if(data.length>0){const totalRating=data.reduce((sum,review)=>sum+review.rating,0);const avgRating=totalRating/data.length;setAverageRating(Math.min(avgRating,5));// 5を超えないように制限\n}}catch(err){setError(\"口コミの取得に失敗しました\");}};const fetchStoreName=async()=>{try{const response=await fetch(`${process.env.REACT_APP_BASE_URL}/stores/store-name/${storeId}`);if(!response.ok)throw new Error(\"店舗情報の取得に失敗しました\");const data=await response.json();setStoreName(data.store_name);}catch(err){console.error(\"エラー詳細:\",err);setError(\"店舗情報の取得に失敗しました\");}};fetchReviews();fetchStoreName();},[storeId]);// 口コミを投稿する関数\nconst handleReviewSubmit=async(rating,comment)=>{try{const response=await fetch(`${process.env.REACT_APP_BASE_URL}/reviews`,{method:\"POST\",headers:{\"Content-type\":\"application/json\"},body:JSON.stringify({store_id:storeId,rating,comment})});if(!response.ok){throw new Error(\"コメント投稿に失敗しました\");}const newReview=await response.json();setReviews(prevReviews=>{const updatedReviews=[newReview,...prevReviews];// 新しい口コミを追加\nconst totalRating=updatedReviews.reduce((sum,rev)=>sum+rev.rating,0);const newAverageRating=totalRating/updatedReviews.length;setAverageRating(Math.min(newAverageRating,5));// 平均評価を更新\nreturn updatedReviews;// 更新されたレビューリストを `setReviews` にセット\n});}catch(err){console.error(\"エラー詳細:\",err);setError(\"コメント投稿に失敗しました\");}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"review-container\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"store-name-review\",children:storeName||\"店舗名を取得中...\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"review-star-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"review-star-background\",children:\"\\u2605\\u2605\\u2605\\u2605\\u2605\"}),/*#__PURE__*/_jsx(\"div\",{className:\"review-star-filled\",style:{width:`${averageRating/5*100}%`},children:\"\\u2605\\u2605\\u2605\\u2605\\u2605\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"average-rating-value\",children:averageRating.toFixed(1)}),/*#__PURE__*/_jsx(\"h2\",{className:\"review-title\",children:\"\\u53E3\\u30B3\\u30DF\\u4E00\\u89A7\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>openModal(storeName),className:\"click-review-button\",children:\"\\u6295\\u7A3F\"}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"error-message\",children:error}),reviews.map(review=>/*#__PURE__*/_jsxs(\"div\",{className:\"review-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"review-rating\",children:[[1,2,3,4,5].map(value=>/*#__PURE__*/_jsx(\"span\",{className:`star ${value<=review.rating?\"selected\":\"\"}`,children:\"\\u2605\"},value)),/*#__PURE__*/_jsx(\"strong\",{style:{marginLeft:\"8px\"},children:review.rating.toFixed(1)})]}),/*#__PURE__*/_jsx(\"p\",{className:\"review-comment\",children:review.comment})]},review.id))]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(Modal,{onSubmit:handleReviewSubmit})]});};export default HospitalReviewList;","map":{"version":3,"names":["React","useEffect","useState","useParams","useModal","Modal","Header","Footer","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","HospitalReviewList","storeId","openModal","reviews","setReviews","error","setError","averageRating","setAverageRating","storeName","setStoreName","fetchReviews","response","fetch","process","env","REACT_APP_BASE_URL","ok","Error","data","json","length","totalRating","reduce","sum","review","rating","avgRating","Math","min","err","fetchStoreName","store_name","console","handleReviewSubmit","comment","method","headers","body","JSON","stringify","store_id","newReview","prevReviews","updatedReviews","rev","newAverageRating","children","className","style","width","toFixed","onClick","map","value","marginLeft","id","onSubmit"],"sources":["/Users/hadamayuka/Desktop/wan_paradise/my-app/src/pages/Hospital/HospitalReviewList.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport { useModal } from \"../../context/ModalContext\";\nimport \"./HospitalReviewList.css\";\nimport Modal from \"../../components/Modal\";\nimport Header from \"../Header\";\nimport Footer from \"../Footer\";\n\ntype Review = {\n  id: number;\n  name: string;\n  store_id: number;\n  store_name: string;\n  rating: number;\n  comment: string;\n  date: string;\n  created_at: string;\n  updated_at: string;\n};\n\nconst HospitalReviewList: React.FC = () => {\n  const { storeId } = useParams<{ storeId: string }>();\n  const { openModal } = useModal();\n  const [reviews, setReviews] = useState<Review[]>([]);\n  const [error, setError] = useState<string | null>(null);\n  const [averageRating, setAverageRating] = useState<number>(0);\n  const [storeName, setStoreName] = useState<string>(\"\");\n\n  useEffect(() => {\n    if (!storeId) return;\n\n    const fetchReviews = async () => {\n      try {\n        const response = await fetch(`${process.env.REACT_APP_BASE_URL}/reviews/${storeId}`);\n        if (!response.ok) throw new Error(\"口コミの取得に失敗しました\");\n\n        const data: Review[] = await response.json();\n        setReviews(data);\n\n        if (data.length > 0) {\n          const totalRating = data.reduce(\n            (sum: number, review: Review) => sum + review.rating, 0);\n          const avgRating = totalRating / data.length; \n          setAverageRating(Math.min(avgRating, 5)); // 5を超えないように制限\n        }\n      } catch (err) {\n        setError(\"口コミの取得に失敗しました\");\n      }\n    };\n\n    const fetchStoreName = async () => {\n      try {\n        const response = await fetch(\n          `${process.env.REACT_APP_BASE_URL}/stores/store-name/${storeId}`\n        );\n        if (!response.ok) throw new Error(\"店舗情報の取得に失敗しました\");\n\n        const data = await response.json();\n        setStoreName(data.store_name);\n      } catch (err) {\n        console.error(\"エラー詳細:\", err);\n        setError(\"店舗情報の取得に失敗しました\");\n      }\n    };\n\n    fetchReviews();\n    fetchStoreName();\n  }, [storeId]);\n\n  // 口コミを投稿する関数\n  const handleReviewSubmit = async (rating: number, comment: string) => {\n    try {\n      const response = await fetch(`${process.env.REACT_APP_BASE_URL}/reviews`, {\n        method: \"POST\",\n        headers: { \"Content-type\": \"application/json\" },\n        body: JSON.stringify({\n          store_id: storeId,\n          rating,\n          comment,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"コメント投稿に失敗しました\");\n      }\n\n      const newReview : Review = await response.json();\n      \n      setReviews((prevReviews) => {\n        const updatedReviews = [newReview, ...prevReviews]; // 新しい口コミを追加\n        const totalRating = updatedReviews.reduce(\n          (sum: number, rev: Review) => sum + rev.rating, 0\n        );\n        const newAverageRating = totalRating / updatedReviews.length;\n        setAverageRating(Math.min(newAverageRating, 5)); // 平均評価を更新\n\n        return updatedReviews; // 更新されたレビューリストを `setReviews` にセット\n      });\n      \n    } catch (err) {\n      console.error(\"エラー詳細:\", err);\n      setError(\"コメント投稿に失敗しました\");\n    }\n  };\n\n  return (\n    <>\n      <Header />\n      <div className=\"review-container\">\n        <h1 className=\"store-name-review\">{storeName || \"店舗名を取得中...\"}</h1>\n\n        <div className=\"review-star-container\">\n          <div className=\"review-star-background\">★★★★★</div>\n          <div\n            className=\"review-star-filled\"\n            style={{\n               width: `${(averageRating /  5) * 100}%` }}\n          >\n            ★★★★★\n          </div>\n        </div>\n        <span className=\"average-rating-value\">{averageRating.toFixed(1)}</span>\n\n        <h2 className=\"review-title\">口コミ一覧</h2>\n        <button onClick={() => openModal(storeName)} className=\"click-review-button\">\n          投稿\n        </button>\n\n        {error && <p className=\"error-message\">{error}</p>}\n\n        {reviews.map((review) => (\n          <div key={review.id} className=\"review-card\">\n            <div className=\"review-rating\">\n              {[1, 2, 3, 4, 5].map((value) => (\n                <span\n                  key={value}\n                  className={`star ${value <= review.rating ? \"selected\" : \"\"}`}\n                >\n                  ★\n                </span>\n              ))}\n              <strong style={{ marginLeft: \"8px\" }}>{review.rating.toFixed(1)}</strong>\n            </div>\n            <p className=\"review-comment\">{review.comment}</p>\n          </div>\n        ))}\n      </div>\n      <Footer/>\n      \n      {/* モーダルを表示、onSubmitを渡す */}\n      <Modal onSubmit={handleReviewSubmit} />\n    </>\n  );\n};\n\nexport default HospitalReviewList;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}