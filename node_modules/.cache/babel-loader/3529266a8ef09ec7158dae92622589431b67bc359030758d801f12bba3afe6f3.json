{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useParams}from\"react-router-dom\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PetShopReviewList=()=>{const{storeId}=useParams();const[reviews,setReviews]=useState([]);const[error,setError]=useState(null);const[showModal,setShowModal]=useState(false);const[selectedRating,setSelectedRating]=useState(0);const[averageRating,setAverageRating]=useState(0);const[storeName,setStoreName]=useState(\"\");//口コミを取得\nuseEffect(()=>{const fetchReviews=async()=>{try{const response=await fetch(\"\".concat(process.env.REACT_APP_BASE_URL,\"/reviews\"));const data=await response.json();// 明示的に created_at で降順ソート\nconst storedData=data.sort((a,b)=>new Date(b.created_at).getTime()-new Date(a.created_at).getTime());// 平均評価を計算\nconst avgRating=storedData.length?storedData.reduce((sum,review)=>sum+review.rating,0)/storedData.length:0;setReviews(storedData);setAverageRating(avgRating);}catch(error){console.error(error);setError(\"口コミの取得に失敗しました\");}};//店舗名を取得する\nconst fetchStoreName=async()=>{try{const response=await fetch(\"\".concat(process.env.REACT_APP_BASE_URL,\"/stores/store-name/\").concat(storeId));const data=await response.json();console.log(\"取得した店舗データ\");setStoreName(data.store_name);}catch(error){setError(\"店舗情報の取得に失敗しました\");}};fetchReviews();fetchStoreName();},[storeId]);//口コミ投稿処理\nconst handleReviewSubmit=async(rating,comment)=>{try{console.log(\"storeId:\",storeId);const response=await fetch(\"\".concat(process.env.REACT_APP_BASE_URL,\"/reviews\"),{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({store_id:storeId,rating,comment})});if(!response.ok){throw new Error(\"コメント投稿に失敗しました\");}const createdReview=await response.json();setReviews(prev=>[createdReview,...prev]);setError(null);setShowModal(false);}catch(error){console.error(error);setError(\"コメント投稿に失敗しました\");}};const handleStarClick=value=>{setSelectedRating(value);};return/*#__PURE__*/_jsxs(\"div\",{className:\"review-container\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"store-name\",children:storeName||\"店舗名を取得中\"}),/*#__PURE__*/_jsx(\"div\",{className:\"average-rating\",children:[1,2,3,4,5].map(value=>/*#__PURE__*/_jsx(\"span\",{className:\"star \".concat(value<=Math.round(averageRating)?\"selected\":\"\"),children:\"\\u2605\"},value))}),/*#__PURE__*/_jsx(\"span\",{className:\"average-rating-value\",children:averageRating.toFixed(1)}),/*#__PURE__*/_jsx(\"h2\",{className:\"review-title\",children:\"\\u53E3\\u30B3\\u30DF\\u4E00\\u89A7\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowModal(true),style:{marginTop:\"20px\"},children:\"\\u6295\\u7A3F\"}),error&&reviews.length>0&&/*#__PURE__*/_jsx(\"p\",{style:{color:\"red\"},children:error}),reviews.map(review=>/*#__PURE__*/_jsxs(\"div\",{className:\"review-card\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"review-rating\",children:[[1,2,3,4,5].map(value=>/*#__PURE__*/_jsx(\"span\",{className:\"star \".concat(value<=review.rating?\"selected\":\"\"),children:\"\\u2605\"},value)),/*#__PURE__*/_jsxs(\"strong\",{children:[review.rating,\".0\"]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"review-comment\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u53E3\\u30B3\\u30DF:\"}),\" \",review.comment]})]},review.id))]});};export default PetShopReviewList;","map":{"version":3,"names":["React","useEffect","useState","useParams","jsx","_jsx","jsxs","_jsxs","PetShopReviewList","storeId","reviews","setReviews","error","setError","showModal","setShowModal","selectedRating","setSelectedRating","averageRating","setAverageRating","storeName","setStoreName","fetchReviews","response","fetch","concat","process","env","REACT_APP_BASE_URL","data","json","storedData","sort","a","b","Date","created_at","getTime","avgRating","length","reduce","sum","review","rating","console","fetchStoreName","log","store_name","handleReviewSubmit","comment","method","headers","body","JSON","stringify","store_id","ok","Error","createdReview","prev","handleStarClick","value","className","children","map","Math","round","toFixed","onClick","style","marginTop","color","id"],"sources":["/Users/hadamayuka/Desktop/wan_paradise/my-app/src/pages/Petshop/PetShopReviewList.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useParams } from \"react-router-dom\";\n\ntype Review = {\n  id: number;\n  name: string;\n  store_id: number;\n  rating: number;\n  comment: string;\n  date: string;\n  created_at: string;\n  updated_at: string;\n};\n\nconst PetShopReviewList: React.FC = () => {\n  const { storeId } = useParams<{ storeId: string }>();\n  const [reviews, setReviews] = useState<Review[]>([]);\n  const [error, setError] = useState<string | null>(null);\n  const [showModal, setShowModal] = useState(false);\n  const [selectedRating, setSelectedRating] = useState<number>(0);\n  const [averageRating, setAverageRating] = useState<number>(0);\n  const [storeName, setStoreName] = useState<string>(\"\");\n\n  //口コミを取得\n  useEffect(() => {\n    const fetchReviews = async () => {\n      try {\n        const response = await fetch(`${process.env.REACT_APP_BASE_URL}/reviews`);\n        const data = await response.json();\n\n        // 明示的に created_at で降順ソート\n        const storedData = data.sort(\n          (a: Review, b: Review) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\n        );\n\n        // 平均評価を計算\n        const avgRating = storedData.length\n          ? storedData.reduce((sum: number, review: Review) => sum + review.rating, 0) /\n            storedData.length\n          : 0;\n\n        setReviews(storedData);\n        setAverageRating(avgRating);\n      } catch (error) {\n        console.error(error);\n        setError(\"口コミの取得に失敗しました\");\n      }\n    };\n\n\n //店舗名を取得する\n  const fetchStoreName = async () => {\n    try {\n      const response = await fetch(`${process.env.REACT_APP_BASE_URL}/stores/store-name/${storeId}`);\n      const data = await response.json();\n      console.log(\"取得した店舗データ\");\n      setStoreName(data.store_name);\n    } catch (error){\n      setError(\"店舗情報の取得に失敗しました\");\n    }\n  };\n  fetchReviews();\n  fetchStoreName();\n}, [storeId]);\n\n\n//口コミ投稿処理\n  const handleReviewSubmit = async (rating: number, comment: string) => {\n    try {\n      console.log(\"storeId:\", storeId);\n\n      const response = await fetch(`${process.env.REACT_APP_BASE_URL}/reviews`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          store_id: storeId,\n          rating,\n          comment,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(\"コメント投稿に失敗しました\");\n      }\n      const createdReview = (await response.json()) as Review;\n\n      setReviews((prev) => [createdReview, ...prev]);\n      setError(null);\n      setShowModal(false);\n    } catch (error) {\n      console.error(error);\n      setError(\"コメント投稿に失敗しました\");\n    }\n  };\n\n  const handleStarClick = (value: number) => {\n    setSelectedRating(value);\n  };\n\n  return (\n    <div className=\"review-container\">\n      {/* 平均評価を表示 */}\n      <h1 className = \"store-name\">{storeName || \"店舗名を取得中\"}</h1>\n      <div className=\"average-rating\">\n        {[1, 2, 3, 4, 5].map((value) => (\n          <span\n            key={value}\n            className={`star ${value <= Math.round(averageRating) ? \"selected\" : \"\"}`}\n          >\n            ★\n          </span>\n        ))}\n      </div>\n      <span className=\"average-rating-value\">\n        {averageRating.toFixed(1)} \n      </span>\n      <h2 className=\"review-title\">口コミ一覧</h2>\n      <button onClick={() => setShowModal(true)} style={{ marginTop: \"20px\" }}>\n        投稿\n      </button>\n      {error && reviews.length > 0 && <p style={{ color: \"red\" }}>{error}</p>}\n      {reviews.map((review) => (\n        <div key={review.id} className=\"review-card\">\n          <p className=\"review-rating\">\n  \n            {[1, 2, 3, 4, 5].map ((value) => (\n              <span key= {value} className= {`star ${value <= review.rating ? \"selected\" : \"\"}`}\n              >\n                ★\n              </span>\n              \n            ))}\n        <strong>{review.rating}.0</strong> \n          </p>\n          <p className=\"review-comment\">\n            <strong>口コミ:</strong> {review.comment}\n          </p>\n        </div>\n      ))}\n    </div>\n  );\n};\n\nexport default PetShopReviewList;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}